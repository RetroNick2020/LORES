#include <stdio.h>
#include <stdlib.h>
#include <dos.h>
#include <conio.h>
#include "lores.h"
#include "tiler.h"
extern volatile unsigned int frameCount;
#define WALL_TOP        0x01
#define WALL_BOTTOM     0x02
#define WALL_LEFT       0x04
#define WALL_RIGHT      0x08
#define BORDER_TOP      0
#define BORDER_BOTTOM   20 // (100/3)
#define BORDER_LEFT     0
#define BORDER_RIGHT    20 // (160/3)
#define FALSE           0
#define TRUE            (!FALSE)
#define DIR_ANY         0x00
#define DIR_UP          0x01
#define DIR_DOWN        0x02
#define DIR_LEFT        0x04
#define DIR_RIGHT       0x08
#define CELL_SOLVED     0x80
#define CELL_TRACED     0x40
unsigned char maze[BORDER_BOTTOM][BORDER_RIGHT];
unsigned char Enter, Exit, xDeadEnd, yDeadEnd;
/*
 * Map and tile data
 */
unsigned char exitile0[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0x9F, 0x99, 0x99, 0x99, 0x99, 0x99, 0x99, 0xF9,
                           0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
unsigned char exitile1[] = {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0x9F, 0x99, 0x99, 0x99, 0x99, 0xF9, 0x22,
                           0x22, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22};
unsigned char exitile2[] = {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0xFF, 0xFF, 0xFF, 0xFF, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0x9F, 0x99, 0x99, 0xF9, 0x22, 0x22,
                           0x22, 0x22, 0xFF, 0xFF, 0xFF, 0xFF, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22};
unsigned char exitile3[] = {0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0xFF, 0xFF, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x9F, 0xF9, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0xFF, 0xFF, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22,
                           0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22, 0x22};
unsigned char far *tileExitAnimate[4] = {exitile0, exitile1, exitile2, exitile3};
// WALL_TOP        0x01
// WALL_BOTTOM     0x02
// WALL_LEFT       0x04
// WALL_RIGHT      0x08
unsigned char tile0[] = {  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
unsigned char tile1[] = {  0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
unsigned char tile2[] = {  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78};
unsigned char tile3[] = {  0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78};
unsigned char tile4[] = {  0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
unsigned char tile5[] = {  0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
unsigned char tile6[] = {  0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78};
unsigned char tile7[] = {  0x77, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x77,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78};
unsigned char tile8[] = {  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77};
unsigned char tile9[] = {  0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77};
unsigned char tileA[] = {  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87};
unsigned char tileB[] = {  0x77, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x77,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87};
unsigned char tileC[] = {  0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77};
unsigned char tileD[] = {  0x87, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x78,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77};
unsigned char tileE[] = {  0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87};
unsigned char tileF[] = {  0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x77, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x77,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x87,
                           0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77, 0x77,
                           0x78, 0x88, 0x88, 0x78, 0x87, 0x88, 0x88, 0x87};
unsigned char far *maze2map[16] = {
                            tile0, tile1, tile2, tile3, tile4, tile5, tile6, tile7,
                            tile8, tile9, tileA, tileB, tileC, tileD, tileE, tileF};
unsigned char far *tilemap[BORDER_BOTTOM][BORDER_RIGHT];
/*
 * 10X10 Sprite
 */
#define FACE_WIDTH      10
#define FACE_HEIGHT     10
unsigned char face[FACE_HEIGHT*FACE_WIDTH/2] = {
    0x88, 0xE8, 0xEE, 0x8E, 0x88,
    0x88, 0xEE, 0xEE, 0xEE, 0x88,
    0xE8, 0xEE, 0xEE, 0xEE, 0x8E,
    0xEE, 0x9E, 0xEE, 0xE9, 0xEE,
    0xEE, 0xEE, 0xEE, 0xEE, 0xEE,
    0xEE, 0xEE, 0xEE, 0xEE, 0xEE,
    0xEE, 0xE9, 0xEE, 0x9E, 0xEE,
    0xE8, 0x9E, 0x99, 0xE9, 0x8E,
    0x88, 0xEE, 0xEE, 0xEE, 0x88,
    0x88, 0xE8, 0xEE, 0x8E, 0x88};
int solve(int x, int y, unsigned char dirEntry)
{
    unsigned char dirOptions;
    /*
     * Keep looking for a solution until exit or dead-end is found
     */
    while (!(maze[y][x] & CELL_SOLVED))
    {
        /*
         * Check if this cell already traced (avoid infinite recursion)
         */
        if (maze[y][x] & CELL_TRACED)
            return FALSE;
        maze[y][x] |= CELL_TRACED;
        /*
         * Get move direction options - not walls or entry direction
         */
        dirOptions = ~(maze[y][x] | dirEntry) & 0x0F;
        /*
         * Check for dead-end
         */
        if (!dirOptions)
        {
            xDeadEnd = x;
            yDeadEnd = y;
            return FALSE;
        }
        /*
         * Look for a single direction to move
         */
        if (dirOptions == DIR_UP)
        {
            y--;
            dirEntry = DIR_DOWN;
        }
        else if (dirOptions == DIR_DOWN)
        {
            y++;
            dirEntry = DIR_UP;
        }
        else if (dirOptions == DIR_LEFT)
        {
            x--;
            dirEntry = DIR_RIGHT;
        }
        else if (dirOptions == DIR_RIGHT)
        {
            x++;
            dirEntry = DIR_LEFT;
        }
        else
        {
            /*
             * Intersection of multiple routes
             */
            unsigned char dir;

            for (dir = 0x08; dir; dir >>= 1)
            {
                if (dir & dirOptions)
                {
                    if (dir == DIR_UP)
                    {
                        if (solve(x, y - 1, DIR_DOWN))
                            return TRUE;
                    }
                    else if (dir == DIR_DOWN)
                    {
                        if (solve(x, y + 1, DIR_UP))
                            return TRUE;
                    }
                    else if (dir == DIR_LEFT)
                    {
                        if (solve(x - 1, y, DIR_RIGHT))
                            return TRUE;
                    }
                    else if (dir == DIR_RIGHT)
                    {
                        if (solve(x + 1, y, DIR_LEFT))
                            return TRUE;
                    }
                }
            }
            return FALSE;
        }
    }
    return TRUE;
}
void cleartrace(void)
{
    int i, j;

    for (i = BORDER_LEFT; i < BORDER_RIGHT; i++)
        for (j = BORDER_TOP; j < BORDER_BOTTOM; j++)
            maze[j][i] &= ~CELL_TRACED;
}
int buildmaze(void)
{
    int i, j;
    unsigned char wall, solved, solveCount;

    for (j = BORDER_TOP; j < BORDER_BOTTOM; j++)
        hlin(0, BORDER_RIGHT*3, j*3, 15);
    for (i = BORDER_LEFT; i < BORDER_RIGHT; i++)
        vlin(i*3, 0, BORDER_BOTTOM*3, 15);
    for (i = BORDER_LEFT; i < BORDER_RIGHT; i++)
        for (j = BORDER_TOP; j < BORDER_BOTTOM; j++)
            maze[j][i] = WALL_TOP | WALL_BOTTOM | WALL_LEFT | WALL_RIGHT;
    /*
     * Pick entrance at left border and exit at right border
     */
    Enter = (rand() % (BORDER_BOTTOM - 2)) + 1;
    Exit  = (rand() % (BORDER_BOTTOM - 2)) + 1;
    /*
     * Set exit as solved
     */
    maze[Exit][BORDER_RIGHT-1] |= CELL_SOLVED;
    /*
     * Add edges and entry/exit to view
     */
    vlin(BORDER_LEFT*3,  Enter * 3 + 1, Enter * 3 + 2, 0);
    vlin(BORDER_RIGHT*3, Exit  * 3 + 1, Exit  * 3 + 2, 0);
    /*
     * Make initial pass erasing boxed-in cells
     */
    for (i = BORDER_LEFT; i < BORDER_RIGHT; i++)
    {
        for (j = BORDER_TOP; j < BORDER_BOTTOM; j++)
        {
            while (maze[j][i] == (WALL_TOP | WALL_BOTTOM | WALL_LEFT | WALL_RIGHT))
            {
                /*
                 * Open up a random wall
                 */
                wall = 1 << (rand() & 3);
                if ((i == BORDER_LEFT     && wall == WALL_LEFT)
                 || (i == BORDER_RIGHT-1  && wall == WALL_RIGHT)
                 || (j == BORDER_TOP      && wall == WALL_TOP)
                 || (j == BORDER_BOTTOM-1 && wall == WALL_BOTTOM))
                    /*
                     * Check border walls
                     */
                    continue;
                /*
                 * Erase wall
                 */
                if (wall == WALL_TOP)
                {
                    maze[j - 1][i] ^= WALL_BOTTOM;
                    hlin(i * 3 + 1, i * 3 + 2, j * 3, 0);
                }
                else if (wall == WALL_BOTTOM)
                {
                    maze[j + 1][i] ^= WALL_TOP;
                    hlin(i * 3 + 1, i * 3 + 2, (j + 1) * 3, 0);
                }
                else if (wall == WALL_LEFT)
                {
                    maze[j][i - 1] ^= WALL_RIGHT;
                    vlin(i * 3, j * 3 + 1, j * 3 + 2, 0);
                }
                else if (wall == WALL_RIGHT)
                {
                    maze[j][i + 1] ^= WALL_LEFT;
                    vlin((i + 1) * 3, j * 3 + 1, j * 3 + 2, 0);
                }
                maze[j][i] ^= wall;
            }
        }
    }
    /*
     * Check every cell for a solution
     */
    solveCount = 0;
    do
    {
        /*
         * Check for a stuck solver
         */
        if (solveCount++ > 1)
            return FALSE;
        solved = TRUE;
        for (i = BORDER_RIGHT-1; i >= BORDER_LEFT; i--)
        {
            for (j = BORDER_TOP; j < BORDER_BOTTOM; j++)
            {
                cleartrace();
                if (solve(i, j, DIR_ANY))
                    maze[j][i] |= CELL_SOLVED;
                else
                {
                    /*
                     * Erase a wall at last dead-end
                     */
                    solved = FALSE;
                    for (wall = 0x08; wall; wall >>= 1)
                    {
                        if ((xDeadEnd == BORDER_LEFT     && wall == WALL_LEFT)
                         || (xDeadEnd == BORDER_RIGHT-1  && wall == WALL_RIGHT)
                         || (yDeadEnd == BORDER_TOP      && wall == WALL_TOP)
                         || (yDeadEnd == BORDER_BOTTOM-1 && wall == WALL_BOTTOM))
                            /*
                             * Check border walls
                             */
                            continue;
                        if (maze[yDeadEnd][xDeadEnd] & wall)
                        {
                            /*
                             * Erase wall
                             */
                            if (wall == WALL_TOP)
                            {
                                if (maze[yDeadEnd - 1][xDeadEnd] & CELL_TRACED)
                                    continue;
                                maze[yDeadEnd - 1][xDeadEnd] ^= WALL_BOTTOM;
                                hlin(xDeadEnd * 3 + 1, xDeadEnd * 3 + 2, yDeadEnd * 3, 0);
                            }
                            else if (wall == WALL_BOTTOM)
                            {
                                if (maze[yDeadEnd + 1][xDeadEnd] & CELL_TRACED)
                                    continue;
                                maze[yDeadEnd + 1][xDeadEnd] ^= WALL_TOP;
                                hlin(xDeadEnd * 3 + 1, xDeadEnd * 3 + 2, (yDeadEnd + 1) * 3, 0);
                            }
                            else if (wall == WALL_LEFT)
                            {
                                if (maze[yDeadEnd][xDeadEnd - 1] & CELL_TRACED)
                                    continue;
                                maze[yDeadEnd][xDeadEnd - 1] ^= WALL_RIGHT;
                                vlin(xDeadEnd * 3, yDeadEnd * 3 + 1, yDeadEnd * 3 + 2, 0);
                            }
                            else if (wall == WALL_RIGHT)
                            {
                                if (maze[yDeadEnd][xDeadEnd + 1] & CELL_TRACED)
                                    continue;
                                maze[yDeadEnd][xDeadEnd + 1] ^= WALL_LEFT;
                                vlin((xDeadEnd + 1) * 3, yDeadEnd * 3 + 1, yDeadEnd * 3 + 2, 0);
                            }
                            maze[yDeadEnd][xDeadEnd] ^= wall;
                            break;
                        }
                    }
                }
            }
        }
    } while (!solved);
    return TRUE;
}
/*
 * convert maze into tile map
 */
void buildmap(void)
{
    int row, col;
    unsigned char far *tileptr;

    for (row = BORDER_TOP; row < BORDER_BOTTOM; row++)
        for (col = BORDER_LEFT; col < BORDER_RIGHT; col++)
            tilemap[row][col] = maze2map[maze[row][col] & 0x0F];
    tilemap[Exit][BORDER_RIGHT-1] = tileExitAnimate[0];
}
/*
 * Demo tiling and scrolling screen
 */
int main(int argc, char **argv)
{
    unsigned int mazeX, mazeY;
    unsigned int faceS, viewS, moveToS, faceT, moveToT, viewT;
    int incS, incT;
    unsigned long st;
    int mode, scrolldir;
    unsigned char cycleExit, quit;
    struct dostime_t time;

    _dos_gettime(&time);
    srand((time.hsecond << 8) | time.second);
    mode = gr160(BLACK, BLACK);
    while (!buildmaze())
    {
        if (kbhit() && (getch() == 'q'))
        {
            txt80();
            exit(-1);
        }
    };
    buildmap();
    //getch();
    /*
     * Set initial coordinates
     */
    mazeX   = BORDER_LEFT;
    mazeY   = Enter;
    faceS   = (mazeX << 4) + 3;
    faceT   = (mazeY << 4) + 3;
    moveToS = faceS;
    moveToT = faceT;
    incS    = 0;
    incT    = 0;
    viewS   = 0;
    viewT   = (BORDER_BOTTOM/4) << 4;
    /*
     * Render initial view
     */
    viewInit(mode, viewS, viewT, BORDER_RIGHT, BORDER_BOTTOM, (unsigned char far * far *)tilemap);
    spriteEnable(0, faceS, faceT, FACE_WIDTH, FACE_HEIGHT, face);
    viewRefresh(0);
    cycleExit = 0;
    quit      = FALSE;
    while (!quit)
    {
#ifdef PROFILE
        rasterBorder(GREY); // Show game logic as grey border
#endif
        /*
         * Update a Exit tile on-the-fly
         */
        if (!(frameCount & 0x0F))
            tileUpdate(BORDER_RIGHT-1, Exit, tileExitAnimate[cycleExit++ & 0x03]);
        /*
         * Check keyboard input
         */
        if (moveToS == faceS && moveToT == faceT)
        {
            if (kbhit())
            {
                switch (getch())
                {
                    case 'i':
                        /*
                         * Move up
                         */
                        if (!(maze[mazeY][mazeX] & WALL_TOP))
                        {
                            mazeY--;
                            moveToT -= 1 << 4;
                            incT     = -2;
                        }
                        break;
                    case 'm':
                        /*
                         * Move down
                         */
                        if (!(maze[mazeY][mazeX] & WALL_BOTTOM))
                        {
                            mazeY++;
                            moveToT += 1 << 4;
                            incT     = 2;
                        }
                        break;
                    case 'j':
                        /*
                         * Move left
                         */
                        if (!(maze[mazeY][mazeX] & WALL_LEFT))
                        {
                            mazeX--;
                            moveToS -= 1 << 4;
                            incS     = -2;
                        }
                        break;
                    case 'k':
                        /*
                         * Move right
                         */
                        if (!(maze[mazeY][mazeX] & WALL_RIGHT))
                        {
                            mazeX++;
                            moveToS += 1 << 4;
                            incS     = 2;
                        }
                        break;
                    case 'q':
                    case 'Q':
                        quit = TRUE;
                        break;
                }
            }
        }
        if (incS || incT)
        {
            st = spritePosition(0, faceS + incS, faceT + incT);
            faceS = st;
            faceT = st >> 16;
            /*
             * Have we made it to our destination?
             */
            if (moveToS == faceS && moveToT == faceT)
            {
                /*
                 * Stop moving and check for exit
                 */
                incS = incT = 0;
                if (mazeX == BORDER_RIGHT-1 && mazeY == Exit)
                    quit = TRUE;
            }
        }
        /*
         * Attempt to keep sprite centered by scrolling map
         */
        scrolldir = 0;
        if (faceS < viewS + (80 - FACE_WIDTH/2))
            scrolldir = SCROLL_RIGHT2;
        else if (faceS > viewS + (80 - FACE_WIDTH/2))
            scrolldir = SCROLL_LEFT2;
        if (faceT < viewT + (50 - FACE_HEIGHT/2))
            scrolldir |= SCROLL_DOWN2;
        else if (faceT > viewT + (50 - FACE_HEIGHT/2))
            scrolldir |= SCROLL_UP2;
#ifdef PROFILE
        rasterBorder(BLACK);
#endif
        st = viewRefresh(scrolldir);
        viewS  = st;
        viewT  = st >> 16;
    }
    viewExit();
    txt80();
    return 0;
}
